module Dec11
class Part1
  attr_reader :data, :galaxies
  def initialize(is_test: false)
    @data = (is_test ? TEST_DATA : DATA).split("\n").map(&:chars)
  end

  def expand_grid
    new_data = []

    # expand rows
    @data.each_with_index do |row, i|
      new_data << row
      next if row.include?('#')
      new_data << row.dup
    end

    # expand columns
    width = new_data[0].length
    (width-1).downto(0) do |i|
      next if new_data.any? { |row| row[i] == '#' }
      new_data.each do |row|
        row.insert(i, '.')
      end
    end

    @data = new_data
  end

  def print
    @data.each do |row|
      puts row.join
    end
  end

  def init_galaxies
    @galaxies = []
    @data.each_with_index do |row, y|
      row.each_with_index do |cell, x|
        next if cell == '.'
        @galaxies << { x: x, y: y }
      end
    end
  end

  def distance(g1, g2)
    (g1[:x] - g2[:x]).abs + (g1[:y] - g2[:y]).abs
  end

  def sum_pairwise_distances
    sum = 0
    (0...@galaxies.length).each do |i|
      (i+1...@galaxies.length).each do |j|
        sum += distance(@galaxies[i], @galaxies[j])
      end
    end
    sum
  end
end

TEST_DATA = <<DATA
...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....
DATA

DATA = <<DATA
........................................#........#.............#............#.........#................................................#....
....#.............................................................................................................................#.........
....................#...................................#......................................#.........................#..................
............................................................................................................................................
#..........#.....................#...............................................................................#..........................
......................................................................................................#.....................#...............
........................#..................................#.............................#..................................................
............................................#.........................#..........#............#.........................#...............#...
...#..........................#.......................#......................................................#..............................
............#...............................................................................................................................
..................................................................................................#.........................................
.........................#..................................................#...............................................................
.....................................#..............................................#..................#...................#................
...............................................#.......................#....................................#...............................
..#...............................................................#...............................................................#.........
..................#.............................................................#.........#........................#........................
.......................................#..............#......#..............................................................................
.............................#........................................................#.........#.............................#.............
...................................#....................................................................#................#...............#..
...#........................................#...............................................................................................
........................................................................#..................#................................................
...........#........................................................................#...............................#.......#...............
................#...........................................#..............................................#................................
............................................................................................................................................
......................#.......#.........#.........#................#...................................#..............................#.....
.........#....................................................................#.............................................................
..................................#..........#............#..............#..................#......#........................................
............................................................................................................................................
...................................................................................#..............................#.............#...........
#..........................#........................#...........................................#...........................................
............................................................................................................................................
.....#.......#......#.........................................#.......#.................#...............#..................#................
..............................................................................#.............................................................
.........#.............................#............................................................#.......................................
.....................................................#.......................................#.................#............................
......................#...........................................#..................................................#..................#...
..............#..........................................#.........................#........................................#...............
..........................#.....................#................................................................................#..........
..........................................................................................................#................................#
.......................................#............#...................................#...................................................
#...............#............................................#....................................................#.........................
............................#..................................................................................................#............
............#.........#.................................#.....................#.............................................................
......................................................................................................#.....................................
...#......................................#.........................#.......................................#..............#......#.....#...
..............................................................................................#.............................................
................#.............#.....................#...........................#...........................................................
............................................................................................................................................
.#......#.......................................#...........................................................................................
.............#..........................#........................#..........#....................#..........................................
............................................................................................................................................
............................................................................................................................................
..........................#........#.................................................................#.........................#............
...#.......#..................................................#......................................................................#......
................#...........................................................................................................................
..........................................#............#.......................................................#............#.............#.
............................................................................................................................................
...................#........#....................#...................................#.............................#........................
............................................................................................................................................
............................................................................................................................................
..............#.........#............................#.............#..............#....................#....................................
......................................#.....#............................................................................................#..
......#...........#...........#.........................................#........................#..........................................
.............................................................................................................#........#.....................
..............................................................#...............................................................#.............
..................................#..............#......................................#...................................................
............................................................................................................................................
.............#..............................#..................................................#............................................
...#.................#.................................................#..............................#.....................................
............................................................................................................................................
............................#..........#................#.......................#.................#..........#..............................
...............................................#..................................................................................#.........
..........#........................#........................................................................................................
......................#................................................................................#....................................
#............................................................................................#..........................#................#..
.................#..............#.......#..........#.........................#..................................#...........................
..................................................................#.....#........................#...............................#..........
.........#....................................#............................................................#..........................#.....
..#.........................................................................................................................................
............................................................................................................................................
....................#........................................#.......................#......................................................
.............................#.............................................................#.........#............#.........#.......#.......
..........................................#............#....................................................................................
............................................................................................................................................
.#...............#....................................................#..........#.............................................#............
............#......................................#.....................................#........#.................#.......................
......#.................#........#.....................................................................#...................#................
........................................#......#...............................................................#.......................#....
............................................................................................................................................
..................................................................#.....#...................................................................
.............#............................................................................................#...............................#.
............................................................................................................................................
............................#........................................................................................#.........#............
......................................................#.....................#.................#.............................................
.......................................#................................................#...................................................
............................................#...............................................................................................
.#..............#..................#..............#.............#..............................................#.....................#......
..........................................................#............#...................................................#................
........................#........................................................#..........................................................
....#..............................................................#........#.........#.....................................................
............................#...................................................................#...........................................
........................................#....................................................................#..........#...................
................................#............#..............................................#...............................................
..#......................................................#......#.................................................#...................#.....
...................#...................................................................................#....................................
.............#....................................#..........................................................................#.............#
........#.................................................................#.....#...............#...........................................
..........................................#............#..................................#...............#.................................
......................................................................................................................#.....................
.................................#...................................................#..............................................#.......
.................................................#..........#...............#..............................................#................
#.....#.................#...........................................#.............................#.............#...........................
.................#..........................................................................................................................
........................................................................#.....................#........#.................................#..
..........#...................#..........................#........................................................................#.........
....................................#...........................#.........................................................#.................
..........................#..................#.....................................#........................................................
.....#................................................#..............................................#........#.............................
.............#......................................................#................................................................#......
....................#............#..............#...............................#...............#.........................................#.
...........................................................................................#..............#......#..........................
#..........................................................#................#.........................................#.....................
.........................................#..................................................................................................
......................#..............................#..................................................................................#...
...#..........#....................#..........#...................................#...............................................#.........
.........................................................#..............#...................................................#...............
............................#....................................#.................................#...............#........................
........................................................................................................................#...................
.#...................#......................................................#............#...........................................#.....#
............#.....................................#.........#.........#.....................................................................
.............................................................................................#................#.............................
.................................#.........#............#.......................................................................#...........
...............#.......#.................................................................................#..................................
.................................................................#.......................................................#..........#.......
............................................................................................................................................
............#.....#.........#...............................#..............................#......#..........#..............................
.......................................................#............................#.......................................................
................................#..................................#...................................................#....................
............................................#......#......................#..........................................................#......
.#..............................................................................................#..................#........................
DATA
end